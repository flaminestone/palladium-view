<div class="plan-space">
  <div class="toolbar">
    <div class="buttons">
      <div class="toolbar-element" (click)="get_plans_and_suites()">
        <i class="fa fa-refresh" aria-hidden="true" [ngClass]="{'fa-spin': this.loading}"></i>
      </div>
      <div class="toolbar-element" (click)="open_modal()" *ngIf="toolbar_opened()">
        <i class="fa fa-pencil" aria-hidden="true"></i>
      </div>

      <div class="danger toolbar-element" (click)="delete_selected_plan()" *ngIf="toolbar_opened()">
        <i class="fa fa-trash" aria-hidden="true"></i>
      </div>
    </div>
  </div>
  <div class="item-list">
    <div class="item hoverer" routerLinkActive="active"  *ngFor="let plan of plans | sortByCreatedAt:'desc'">
      <div class="item-name">
        <a [routerLink]="['./plan', plan.id]">{{plan.name}}</a>
        <span class="count" title="{{plan.all_statistic['attitude'] || 0 | percent:'2.2-3'}}"><b>/ {{ force_floor(plan.all_statistic['attitude']) || 0 | percent}}</b></span>
      </div>
      <div class="statistic status-name" *ngIf="this.statuses">
        <span *ngFor="let status of plan.statistic" class="status-position"
              [ngStyle]="{ 'width': (status['count'] / plan.all_statistic['all'] * 100) + '%', 'background-color': this.statuses[status['status']]['color']}" (value)=status>
        </span>
      </div>
      <div class="item-statistic">
        <ng-container *ngIf="plan.statistic && this.statuses">
        <span *ngFor="let status of plan.statistic" [ngStyle]="{ 'width': (status['count'] / plan.all_statistic['all'] * 100) + '%', 'background-color': this.statuses[status['status']]['color']}" (value)=status>
        </span>
        </ng-container>
      </div>
    </div>
  </div>
</div>
<modal #Modal>
  <modal-header>
    <h1>Plan edit</h1>
  </modal-header>
  <modal-content>
    <form autocomplete="off" #form="ngForm" (ngSubmit)="edit_plan_modal(form, Modal, form.valid )">
      <input type="text" class="plan-name" name="name" ngModel required #name="ngModel" autofocus>
      <small [hidden]="name.valid || (name.pristine && !form.submitted)">
        Plan name can't be empty.
      </small>
    </form>
  </modal-content>
  <modal-footer>
    <button class="btn btn-success" [disabled]="!form.valid" (click)="form.ngSubmit.emit(form)">Save</button>
  </modal-footer>
</modal>
<router-outlet></router-outlet>
