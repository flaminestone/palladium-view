<div class="plan-space">
  <div class="toolbar">
    <div class="buttons">
      <div class="toolbar-element" (click)="init_data()">
        <i class="fa fa-refresh" aria-hidden="true" [ngClass]="{'fa-spin': this.loading}"></i>
      </div>
      <div class="danger toolbar-element" (click)="open_modal()" *ngIf="toolbar_opened()">
        <i class="fa fa-cogs" aria-hidden="true"></i>
      </div>
    </div>
  </div>
  <div class="item-list">
    <div class="item hoverer" routerLinkActive="active"  *ngFor="let plan of plans | sortByCreatedAt:'desc'">
      <div class="item-name">
        <a [routerLink]="['./plan', plan.id]">{{plan.name}}</a>
        <span class="count" title="{{plan.all_statistic['attitude'] || 0 | percent:'2.2-3'}}"><b>/ {{ force_floor(plan.all_statistic['attitude']) || 0 | percent}}</b></span>
      </div>
      <div class="statistic status-name" *ngIf="this.statuses">
        <span *ngFor="let status of plan.statistic" class="status-position"
              [ngStyle]="{ 'width': (status['count'] / plan.all_statistic['all'] * 100) + '%', 'background-color': this.statuses[status['status']]['color']}" (value)=status>
        </span>
      </div>
      <div class="item-statistic">
        <ng-container *ngIf="plan.statistic && this.statuses">
        <span *ngFor="let status of plan.statistic" [ngStyle]="{ 'width': (status['count'] / plan.all_statistic['all'] * 100) + '%', 'background-color': this.statuses[status['status']]['color']}" (value)=status>
        </span>
        </ng-container>
      </div>
    </div>
  </div>
</div>
<modal #Modal>
  <modal-header>
    <h2>Plan edit</h2>
  </modal-header>
  <modal-content>
    <div class="settings_content">
      <div class="item-description">
        <form autocomplete="off" #form="ngForm" (ngSubmit)="edit_plan_modal(form, Modal, form.valid )">
          <div class="item-option">
            <input type="text" name="name" ngModel required #name="ngModel" autofocus>
            <small [hidden]="name.valid || (name.pristine && !form.submitted)">
              Plan name can't be empty.
            </small>
          </div>
          <div class="item-option">
            <label *ngIf="plan"> Created at: {{plan.created_at}}</label>
          </div>
          <div class="item-option">
            <label *ngIf="plan"> Updated at: {{plan.updated_at}}</label>
          </div>
          <button class="btn btn-danger" (click)="delete_selected_plan()">Delete</button>
          <button class="btn btn-success save_button" [disabled]="!form.valid" (click)="form.ngSubmit.emit(form)">Save</button>
        </form>
      </div>
    </div>

  </modal-content>
</modal>


<router-outlet></router-outlet>
