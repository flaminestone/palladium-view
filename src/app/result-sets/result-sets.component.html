<div class="result-set-space">

    <div class="toolbar">
      <div class="filters">
        <app-filters [statuses] = statuses [statistic] = statistic (selected_statuses_emmit)="show_all()"></app-filters>
      </div>
      <div class="buttons">
        <div class="button check_button" (click)="unselect_all()" [ngClass]="{'disabled': this.loading}" *ngIf="select_all_flag">
          <i class="fa fa-check-square-o" aria-hidden="true"></i>
        </div>
        <div class="button check_button" (click)="select_all()" [ngClass]="{'disabled': this.loading}" *ngIf="!select_all_flag">
          <i class="fa fa-square-o" aria-hidden="true"></i>
        </div>
        <div class="button add_result_button" (click)="add_result_modal()" [ngClass]="{'disabled': this.loading || get_selected_count() === 0}">
          <i class="fa fa-plus-circle" aria-hidden="true"></i> {{get_selected_count()}}
        </div>
        <input class="search-input" type="text" (keydown.esc)="search_open()" placeholder="Search" (keyup)="write_to_search($event)" *ngIf="search_input" #search_input_element>
        <div class="button" (click)="update_click()"  *ngIf="!search_input" [ngClass]="{'disabled': this.loading}">
          <i class="fa fa-refresh" aria-hidden="true" [ngClass]="{'fa-spin': this.loading}"></i>
        </div>
        <div class="button" (click)="open_history_page()" [ngClass]="{'disabled': this.loading}" *ngIf="object && !search_input">
          <i class="fa fa-history" aria-hidden="true"></i>
        </div>

        <div class="button" (click)="open_modal()" [ngClass]="{'disabled': this.loading}" *ngIf="object && !search_input">
          <i class="fa fa-cogs" aria-hidden="true"></i>
        </div>
        <div class="button search_button" (click)="search_open()" [ngClass]="{'disabled': this.loading, 'long-search': search_input}">
          <i class="fa fa-search" aria-hidden="true"></i>
        </div>
      </div>
    </div>
  <div class="item-list" (click)="clicked($event)" (scroll)="colScroll($event)" (dblclick)="copy_result_set_name($event)">
    <div [style.height.px]="Math.max(0, Math.max(0, scrollPos - 10) * 33 )"></div>
    <div class="item hoverer bipolar-item"
         *ngFor="let object of show_all_elemets | sortByCreatedAt:'asc'| virtualscroll:scrollPos:30" [ngClass]="{'activated': object.active}" [ngStyle]="getStyles(object)">
      <div class="result-set-discriber centered-data">
        <div class="centered-data checkbox-item">
          <input type="checkbox" [(ngModel)]="object.selected">
        </div>
        <div class="item-name">
          <a title={{object.name}} class="result_set_link pointer" attr.data-id="{{object.id}}" attr.data-path="{{object.path}}">{{object.name}}</a>
        </div>
        <div *ngIf="this.statuses && !object.deleting" class="status-name">
          <b>{{get_status_by_id(object['status']).name}}</b>
        </div>
        <div *ngIf="object.deleting">
          <b style="color: #ca0a0a">Deleting...</b>
        </div>
        <div *ngIf="settings.inaccurately_deleting"><a class="inaccurately_trash" (click)="inaccurately_delete(object)"><i class="fa fa-trash" aria-hidden="true"></i></a></div>
      </div>
    </div>
    <div [style.height.px]="Math.max(0, (show_all_elemets.length - scrollPos - 30)  * 33)"></div>
    <div class="empty_list_message" [ngClass]="{'hidden': result_sets_and_cases.length > 0}">
      <p>Result set list is empty</p>
    </div>
  </div>
</div>

<modal #Modal>
  <modal-header>
    <h1>Change object name</h1>
  </modal-header>
  <modal-content>
    <div class="settings_content">
      <div class="item-description">
          <form autocomplete="off" #form="ngForm"  (ngSubmit)="edit_object(form, form.valid )">
            <div class="item-option">
            <input type="text" class="result-set-name" name="name" ngModel required #name="ngModel" autofocus>
            <small [hidden]="name.valid || (name.pristine && !form.submitted)">
              result_set name can't be empty.
            </small>
            </div>
            <div class="item-option">
              <label *ngIf="object"> Created at: {{object.created_at}}</label>
            </div>
            <div class="item-option">
              <label *ngIf="object"> Updated at: {{object.updated_at}}</label>
            </div>
            <button class="btn btn-success save_button" [disabled]="!form.valid" (click)="form.ngSubmit.emit(form)">Save</button>
          </form>
        <button class="btn btn-danger" (click)="delete_object()">Delete</button>
      </div>
    </div>
  </modal-content>
</modal>

<modal #AddResultModal (onClose)="addresultform.reset()">
  <modal-header>
    <h1>Add Result</h1>
  </modal-header>
  <modal-content>
    Add result for <b>{{get_selected_count()}}</b> result_sets
    <form autocomplete="off" #addresultform="ngForm">

      <select ngModel name="result_status" #result_status="ngModel">
        <option *ngFor="let item of  not_blocked_status"
                [ngValue]="item">
          {{item.name}}
        </option>
      </select>
      <small *ngIf="addresultform.controls['result_status']" [hidden]="(addresultform.controls['result_status'].value !== '') && !addresultform.submitted">
        Need to change status
      </small>
      <textarea placeholder="Result description" class="result-description" name="result_description" ngModel required #result_description="ngModel" autofocus></textarea>
    </form>
  </modal-content>
  <modal-footer>
    <button class="btn btn-success" (click)="add_results(addresultform, AddResultModal)">Add result</button>
  </modal-footer>
</modal>

<router-outlet (activate)="onActivate($event)"></router-outlet>
